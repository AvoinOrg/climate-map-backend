FROM node:15.0

ARG NODE_ENV="development"
ENV NODE_ENV=${NODE_ENV}

ARG NODE_PORT=8080
ENV NODE_PORT=${NODE_PORT}

ARG POSTGRES_HOST="localhost"
ENV POSTGRES_PORT=${POSTGRES_PORT}

ARG POSTGRES_USER="test"
ENV POSTGRES_USER=${POSTGRES_USER}

ARG POSTGRES_PASSWORD="1234"
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}

ARG POSTGRES_DB="test_db"
ENV POSTGRES_DB=${POSTGRES_DB}

ARG POSTGRES_PORT=5433
ENV POSTGRES_PORT=${POSTGRES_PORT}

ARG JWT_SECRET="very_secret"
ENV JWT_SECRET=${JWT_SECRET}

RUN mkdir -p /home/node/app/node_modules

WORKDIR /home/node/app

COPY package*.json ./
COPY docker-entrypoint.sh ./

RUN chown -R node:node /home/node/app

USER node

EXPOSE 8080

ENTRYPOINT ["/bin/bash", "/home/node/app/docker-entrypoint.sh"]

